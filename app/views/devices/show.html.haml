.level
  .level-left
    %h1.title
      %i.fa.fa-server
      = @device.human_identifier
  .level-right
    = link_to edit_device_path(@device), class: 'button level-item' do
      %span.icon
        %i.fa.fa-edit
      =t('edit')

.columns
  .column
    %h2.subtitle Properties
    - if @device.location
      %p
        %strong Location:
        %i.fa.fa-globe
        = link_to @device.location.name, @device.location
    - if @device.kind.present?
      %p
        %strong Kind:
        = @device.kind
    - if @device.description.present?
      %p
        %strong Description:
        = @device.description
    - if @device.num_links.present?
      %p
        %strong Number Links:
        = @device.num_links
    - if @device.model.present?
      %p
        %strong Model:
        = @device.model
    - if @device.manufacturer.present?
      %p
        %strong Manufacturer:
        = @device.manufacturer
    - if @device.url.present?
      %p
        %strong URL
        = link_to @device.url, @device.url, target: '_new'
  .column
    - if @device.images
      %h2.subtitle Images
      .columns
        .column
          - @device.images.each do |image|
            = link_to url_for(image), target: '_new' do
              %figure
                = image_tag image.variant(resize_to_fill: [140, 140]).processed
              = image.filename
      = link_to 'Add image', '', class: 'button'


-#- @connected_device.connections.each do |connection|
-#  = render partial: 'links/link_tag', locals: {connection: connection}

- if @device.num_links.to_i > 0
  %section.section
    .table-container
      %table.table
        %thead
          %tr
            - (1..@device.num_links).each do |idx|
              %td=idx
        %tbody
          %tr
            - (1..@device.num_links).each do |idx|
              - connections = @connected_device.connections_at(port: idx)
              - if connections.present?
                %td
                  - connections.each do |connection|
                    - if connection.target&.human_identifier
                      %span.tags.has-addons
                        %span.tag.is-info
                          %span.icon.is-light
                            - if connection.target.instance_of? Device
                              %i.fa.fa-hdd
                            - else
                              %i.fa.fa-globe
                          = connection.target.human_identifier
                        - if connection.target_slot
                          %span.tag
                            %span.icon
                              %i.fa.fa-ethernet
                          .tag.is-link
                            = connection.target_slot

                    - if next_connection = connection.next_connection
                      = render partial: 'links/link_tag', locals: {connection: next_connection}

                    - if connection.name.present?
                      .tag.is-warning
                        = connection.name
              - else
                %td
                  = link_to new_device_link_path(@device, slot: idx) do
                    %button.button
                      %i.fa.fa-plus



%br


%br
%h2.subtitle
  %i.fa.fa-network-wired
  #{@device.links.count} Links
%table.table.is-fullwidth.is-narrow
  %thead
    %tr
      %th # this end
      %th
      %th # other end
      %th other end
      %th name
      %th
  %tbody
    - @device.links.find_each do |link|
      -# Will be: from this port: to ... other port other device/location
      - this_end = (link.one_end == @device) ? @device : link.other_end
      - this_slot = (link.one_end == @device) ? link.slot_one_end : link.slot_other_end
      - other_end = (link.other_end == @device) ? link.one_end : link.other_end
      - other_end_slot = (link.one_end == @device) ? link.slot_other_end : link.slot_one_end

      %tr
        %td
          = this_slot
          - if link.kind.present?
            %small
              (#{link.kind})
        %td ->
        %td= other_end_slot
        %td
          - if other_end
            -#= debug other_end
            = link_to other_end.name, other_end
            \
            - if (other_end.instance_of? Device) && other_end.kind.present?
              %small
                (#{other_end.kind})
            - if (other_end.instance_of? Device) && other_end.location&.name
              %small
                (#{link_to other_end.location&.name, other_end.location})
              - if other_end.connector?
                %span.icon
                  %i.fa.fa-link
                %span.icon
                  %i.fa.fa-arrow-right
                -#= other_end.next_end(from: @device, slot: other_end_slot)&.name
        %td
          = link.name
        %td.actions.buttons
          = link_to [@device, link], method: :delete, data: { confirm: 'Are you sure?' }, class: 'button is-danger' do
            %span.icon
              %i.fa.fa-times
            = t('destroy')
          = link_to edit_device_link_path(@device, link), class: 'button is-warning' do
            %span.icon
              %i.fa.fa-edit
            = t('edit')
    %tr
      %td
        = link_to 'add link', new_device_link_path(@device), class: 'button'
      %td
      %td
      %td
      %td
      %td
    

.buttons
  = link_to edit_device_path(@device), class: 'button' do
    %span.icon
      %i.fa.fa-edit
    = t('edit')

  = link_to device_label_path(@device), class: 'button' do
    %span.icon
      %i.fa.fa-tags
    =t('show label')
